{"ast":null,"code":"import _classCallCheck from \"/home/nathan/ENPC/ProDep/language-allocation/front/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/nathan/ENPC/ProDep/language-allocation/front/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/nathan/ENPC/ProDep/language-allocation/front/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/nathan/ENPC/ProDep/language-allocation/front/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/nathan/ENPC/ProDep/language-allocation/front/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/nathan/ENPC/ProDep/language-allocation/front/src/LoginPage.js\";\nimport React, { Component } from 'react';\nimport './LoginPage.css';\nimport axios from 'axios';\nimport url from \"./url\";\nimport queryString from 'query-string';\nimport { Cookies } from 'react-cookie';\nimport { Redirect } from 'react-router-dom';\nexport var login = function login(user) {\n  return axios.post('admin/login', {\n    email: user.email,\n    password: user.password\n  }).then(function (response) {\n    localStorage.setItem('usertoken', response.data);\n    return response.data;\n  }).catch(function (err) {\n    console.log(err);\n  });\n};\n\nvar LoginPage =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(LoginPage, _Component);\n\n  function LoginPage(props) {\n    var _this;\n\n    _classCallCheck(this, LoginPage);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(LoginPage).call(this, props));\n\n    _this.getUserData = function (user_id) {\n      axios.get(url + \"users/students/\" + user_id).then(function (result) {\n        var cookies = new Cookies();\n        cookies.set('user_id', result.data.result.id, {\n          maxAge: 60 * 15\n        });\n      }, function (error) {\n        console.log('Error: Bad Request');\n      });\n    };\n\n    _this.getState = function () {\n      return _this.state;\n    };\n\n    _this.onSubmit = function () {\n      _this.props.handlePageChange(\"questionnaire\"); //ajouter une requête\n\n    };\n\n    _this.handleInputChange = function (event) {\n      var target = event.target;\n      var value = target.value;\n      var name = target.name;\n      var new_state = _this.state;\n      new_state[name] = value;\n\n      _this.setState(new_state);\n    };\n\n    _this.state = {\n      user_id: null\n    };\n    return _this;\n  }\n\n  _createClass(LoginPage, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var token = queryString.parse(this.props.location.search).token;\n      axios.get(url + \"login/\" + token).then(function (result) {\n        var new_state = _this2.state;\n        new_state.user_id = result.data.result;\n\n        _this2.setState({\n          new_state: new_state\n        });\n\n        _this2.getUserData(result.data.result);\n      }, function (error) {\n        console.log(\"Error 404 : Invalid Token\");\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (this.state.user_id === null) {\n        return React.createElement(Redirect, {\n          to: \"/\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 82\n          },\n          __self: this\n        });\n      } else {\n        return React.createElement(Redirect, {\n          to: \"/404\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 87\n          },\n          __self: this\n        });\n      }\n    }\n  }]);\n\n  return LoginPage;\n}(Component);\n\nexport default LoginPage;","map":{"version":3,"sources":["/home/nathan/ENPC/ProDep/language-allocation/front/src/LoginPage.js"],"names":["React","Component","axios","url","queryString","Cookies","Redirect","login","user","post","email","password","then","response","localStorage","setItem","data","catch","err","console","log","LoginPage","props","getUserData","user_id","get","result","cookies","set","id","maxAge","error","getState","state","onSubmit","handlePageChange","handleInputChange","event","target","value","name","new_state","setState","token","parse","location","search"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport './LoginPage.css';\nimport axios from 'axios';\nimport url from \"./url\";\nimport queryString from 'query-string';\nimport {Cookies} from 'react-cookie';\nimport { Redirect } from 'react-router-dom'\n\nexport const login = user => {\n  return axios\n    .post('admin/login', {\n      email: user.email,\n      password: user.password\n    })\n    .then(response => {\n      localStorage.setItem('usertoken', response.data)\n      return response.data\n    })\n    .catch(err => {\n      console.log(err)\n    })\n}\n\nclass LoginPage extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {user_id:null};\n      }\n    componentDidMount() {\n        const token = queryString.parse(this.props.location.search).token;\n        axios.get(url+\"login/\"+token)\n        .then(\n          (result) => {\n            let new_state=this.state;\n            new_state.user_id=result.data.result;\n            this.setState({\n              new_state\n            });\n            this.getUserData(result.data.result);\n          },\n          (error) => {\n            console.log(\"Error 404 : Invalid Token\");\n          }\n        );\n\n      }\n\n    getUserData=(user_id)=>{\n      axios.get(url+\"users/students/\"+user_id)\n      .then(\n        (result) => {\n          const cookies = new Cookies();\n          cookies.set('user_id', result.data.result.id, {maxAge : 60*15 });\n        },\n        (error) => {\n          console.log('Error: Bad Request');\n        }\n      )\n    }\n\n    getState=()=>{\n        return this.state;\n    }\n\n    onSubmit=()=>{\n        this.props.handlePageChange(\"questionnaire\");//ajouter une requête\n    }\n\n    handleInputChange=(event)=>{\n        const target = event.target;\n        const value =  target.value;\n        const name = target.name;\n\n        let new_state= this.state;\n        new_state[name]=value;\n        this.setState(new_state);\n    }\n\n    render() {\n      if (this.state.user_id === null){\n        return (\n          <Redirect to='/'  />\n        );\n      }\n      else{\n        return (\n          <Redirect to='/404'  />\n        );\n      }\n    }\n  }\n\n\nexport default LoginPage;\n"]},"metadata":{},"sourceType":"module"}